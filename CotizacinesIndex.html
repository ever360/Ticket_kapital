<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cotizaci√≥n - Cielo Rasos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      color: #333;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #007BFF;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .svg-logo {
      width: 150px;
      height: auto;
    }
    .company-info {
      text-align: right;
    }
    h1 {
      text-align: center;
      color: #007BFF;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    .totals {
      text-align: right;
      margin-top: 20px;
    }
    .observaciones {
      margin-top: 30px;
    }
    .footer {
      text-align: center;
      margin-top: 50px;
      font-size: 0.9em;
      color: gray;
    }
    .btn-compartir {
      margin: 20px auto;
      padding: 12px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      display: block;
      transition: background-color 0.3s;
    }
    .btn-compartir:hover {
      background-color: #218838;
    }
    .btn-compartir:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }

    /* Ocultar bot√≥n al imprimir */
    @media print {
      .btn-compartir {
        display:   !important;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <!-- Logo SVG -->
    <div class="svg-logo">
      <svg viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
        <polygon points="60,140 60,30 90,30 90,150" fill="blue" />
        <polygon points="50,40 50,30 190,-20 89,50" fill="red" />
        <line x1="150" y2="5" x2="250" y3="200" style="stroke:red;stroke-width:8" />
        <text x="140" y="60" fill="blue" font-size="45">PVC</text>
        <text x="110" y="110" fill="red" font-size="33">CIELO RAZOS</text>
      </svg>
    </div>

    <div class="company-info">
      <strong>CIELO RAZOS PVC 1</strong><br>
      Calle 123, Ciudad<br>
      Tel: 123-456-7890<br>
      DIRECCI√ìN CALLE 11-11
    </div>
  </div>

  <h1>COTIZACI√ìN</h1>

  <p><strong>Cliente:</strong> Juan P√©rez<br>
     <strong>Fecha:</strong> 14/05/2025<br>
     <strong>Direcci√≥n:</strong> Av. Principal #456, Ciudad</p>
     <br>
     <p>
       Para 50 mts cuadrados la cantidad sugerida es de:
     </p>

  <table>
    <tr>
      <th>Producto</th>
      <th>Cantidad</th>
    </tr>
    <tr>
      <td>L√ÅMINAS</td>
      <td>30</td>
    </tr>
    <tr>
      <td>PERIMETRALES</td>
      <td>3</td>
    </tr>
     <tr>
      <td>OMEGAS</td>
      <td>3</td>
    </tr>
     <tr>
      <td>VIGUETAS</td>
      <td>3</td>
    </tr>
     <tr>
      <td>√ÅNGULOS</td>
      <td>3</td>
    </tr>
    <tr>
      <td>TORNILLOS</td>
      <td>100</td>     
    </tr>
  </table>

  <div class="totals">
    <p><strong>Subtotal:</strong> $455.00</p>
    <p><strong>Instalaci√≥n:</strong> $54.60</p>
    <p><strong>Total:</strong> <strong>$ 509.60</strong></p>
  </div>

  <div class="observaciones">
    <p><strong>Observaciones:</strong></p>
    <p>Esta cotizaci√≥n tiene una validez de 5 d√≠as. Los precios pueden variar seg√∫n disponibilidad. No incluye instalaci√≥n.</p>
  </div>

  <button class="btn-compartir" id="btnCompartirPDF" onclick="compartirPDF()">üìÑ Compartir PDF</button>

  <div class="footer">
    Gracias por confiar en nosotros. <br>
    CIELO RAZOS PVC ‚Äì Calidad que resalta tu techo.
  </div>

  <!-- Librer√≠as CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    function compartirPDF() {
      const boton = document.getElementById('btnCompartirPDF');
      boton.disabled = true;
      boton.textContent = '‚è≥ Generando PDF...';

      // Obtener el elemento completo del documento
      const elemento = document.body;
      
      html2canvas(elemento, {
          scale: 2,
          useCORS: true,
          backgroundColor: '#ffffff',
          width: elemento.scrollWidth,
          height: elemento.scrollHeight
      }).then(function(canvas) {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF({
              orientation: 'portrait',
              unit: 'mm',
              format: 'a4'
          });

          const imgData = canvas.toDataURL('image/png');
          const imgWidth = 210; // Ancho A4 en mm
          const pageHeight = 295; // Alto A4 en mm
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          let heightLeft = imgHeight;

          let position = 0;

          // Agregar primera p√°gina
          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;

          // Si el contenido es muy largo, agregar p√°ginas adicionales
          while (heightLeft >= 0) {
              position = heightLeft - imgHeight;
              pdf.addPage();
              pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
              heightLeft -= pageHeight;
          }
          
          // Crear blob del PDF
          const pdfBlob = pdf.output('blob');
          const file = new File([pdfBlob], 'cotizacion_cielo_razos.pdf', { type: "application/pdf" });

          // Intentar compartir usando Web Share API
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
              navigator.share({
                  files: [file],
                  title: 'Cotizaci√≥n - CIELO RAZOS PVC',
                  text: 'Cotizaci√≥n para cielo rasos - Juan P√©rez'
              })
              .then(() => {
                  console.log('PDF compartido correctamente');
                  boton.disabled = false;
                  boton.textContent = '‚úÖ Compartido';
                  setTimeout(() => {
                      boton.textContent = 'üìÑ Compartir PDF';
                  }, 2000);
              })
              .catch((error) => {
                  console.log('Error al compartir PDF:', error);
                  // Fallback: descargar PDF y mostrar mensaje
                  descargarPDF(pdf);
              });
          } else {
              // Fallback: descargar el PDF
              descargarPDF(pdf);
          }
      }).catch(function(error) {
          console.error('Error al generar PDF:', error);
          boton.disabled = false;
          boton.textContent = '‚ùå Error';
          setTimeout(() => {
              boton.textContent = 'üìÑ Compartir PDF';
          }, 2000);
      });
    }

    function descargarPDF(pdf) {
      const boton = document.getElementById('btnCompartirPDF');
      
      // Descargar el PDF
      pdf.save('cotizacion_cielo_razos.pdf');
      
      // Mostrar mensaje de WhatsApp como alternativa
      setTimeout(() => {
          const mensaje = `üìã *COTIZACI√ìN CIELO RAZOS PVC*
          
üë§ Cliente: Juan P√©rez
üìÖ Fecha: 14/05/2025
üìè √Årea: 50 m¬≤
üí∞ Total: $509.60

‚úÖ He generado el PDF de la cotizaci√≥n para ti.

üìû Para m√°s informaci√≥n contacta:
Tel: 123-456-7890`;

          if (confirm('PDF descargado. ¬øDeseas compartir los detalles por WhatsApp?')) {
              const urlWhatsApp = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
              window.open(urlWhatsApp, '_blank');
          }
          
          boton.disabled = false;
          boton.textContent = 'üìÑ Compartir PDF';
      }, 1000);
    }
  </script>

</body>
</html>
